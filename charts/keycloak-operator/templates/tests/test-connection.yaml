apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "keycloak-operator.fullname" . }}-test-connection"
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "keycloak-operator.labels" . | nindent 4 }}
  {{- $baseAnnotations := include "keycloak-operator.annotations" . | fromYaml }}
  {{- $hookAnnotations := dict "helm.sh/hook" "test" "helm.sh/hook-delete-policy" "before-hook-creation,hook-succeeded" }}
  {{- $annotations := merge $baseAnnotations $hookAnnotations }}
  annotations:
    {{- toYaml $annotations | nindent 4 }}
spec:
  restartPolicy: Never
  containers:
  - name: wget
    image: busybox:1.36.1
    command: ['wget']
    args: ['http://{{ include "keycloak-operator.fullname" . }}:80/q/health/ready']